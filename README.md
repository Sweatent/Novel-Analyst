# EPUB å°è¯´é‡‘å¥åˆ†æå™¨

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„Pythonè„šæœ¬ï¼Œç”¨äºåˆ†æEPUBæ ¼å¼çš„å°è¯´ï¼Œåˆ©ç”¨AIæ¨¡å‹ï¼ˆå¦‚GPTç³»åˆ—ï¼‰è‡ªåŠ¨æå–å’Œæ€»ç»“ä¹¦ä¸­çš„â€œé‡‘å¥â€å’Œç« èŠ‚ä¸»çº¿ã€‚
## ç¼˜ç”±
åœ¨é˜…è¯»å¿ƒè·³å¼•æ“æ—¶å€™ï¼Œæ€»ä¼šçœ‹åˆ°è€ç™»çš„ä¸€äº›é‡‘å¥åè¨€ï¼Œä½†æ˜¯è‹¦äºå¤ªå¤šäº†ï¼Œä¸”éƒ½æ²¡åšè®°å½•ï¼Œæ•…æ‹¿Geminiå†™äº†3ä»¶å¥—ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **åŒæ¨¡å¼æ“ä½œ**ï¼šæ”¯æŒç›´è§‚çš„**äº¤äº’å¼èœå•æ¨¡å¼**å’Œå¼ºå¤§çš„**å‘½ä»¤è¡Œæ¨¡å¼**ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„ä½¿ç”¨éœ€æ±‚ã€‚
- **æ™ºèƒ½é…ç½®**ï¼šé€šè¿‡`config.json`æ–‡ä»¶ä¿å­˜å’ŒåŠ è½½è®¾ç½®ï¼Œå…å»é‡å¤è¾“å…¥çš„éº»çƒ¦ã€‚
- **APIè¿é€šæ€§æµ‹è¯•**ï¼šåœ¨è®¾ç½®èœå•ä¸­å†…ç½®APIæµ‹è¯•åŠŸèƒ½ï¼Œæ–¹ä¾¿å¿«é€ŸéªŒè¯ç½‘ç»œå’Œå¯†é’¥æ˜¯å¦æœ‰æ•ˆã€‚
- **æ–­ç‚¹ç»­ä¼ **ï¼šèƒ½å¤Ÿè‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½åˆ†æè¿›åº¦ï¼Œå³ä½¿ç¨‹åºæ„å¤–ä¸­æ–­ï¼Œä¹Ÿèƒ½ä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­ï¼ŒèŠ‚çœæ—¶é—´å’Œæˆæœ¬ã€‚
- **å¼ºå¤§çš„å®¹é”™ä¸é‡è¯•**ï¼šå†…ç½®APIè°ƒç”¨å¤±è´¥åçš„è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œå¹¶èƒ½å•ç‹¬é‡è¯•åˆ†æå¤±è´¥çš„ç« èŠ‚ã€‚
- **çµæ´»çš„åˆ†æé€‰é¡¹**ï¼šæ”¯æŒæµ‹è¯•æ¨¡å¼ã€é‡æ–°åˆ†ææŒ‡å®šç« èŠ‚ã€æŸ¥æ‰¾å¹¶è¡¥å……ç¼ºå¤±ç« èŠ‚ç­‰å¤šç§é«˜çº§åŠŸèƒ½ã€‚
- **ç»“æœåˆ†å—ä¿å­˜**ï¼šå°†å¤§é‡çš„åˆ†æç»“æœè‡ªåŠ¨åˆ‡å‰²æˆå°æ–‡ä»¶ï¼Œä¾¿äºç®¡ç†å’ŒæŸ¥é˜…ã€‚
- **è‡ªåŠ¨åŒ–æŠ¥å‘Š**ï¼šåˆ†æå®Œæˆåï¼Œè‡ªåŠ¨ç”Ÿæˆæ ¼å¼ç¾è§‚çš„Markdownæ ¼å¼æŠ¥å‘Šã€‚

## ğŸš€ ä½¿ç”¨æµç¨‹

### æ–¹å¼ä¸€ï¼šäº¤äº’å¼èœå•æ¨¡å¼ (æ¨èæ–°æ‰‹ä½¿ç”¨)

å¦‚æœæ‚¨ä¸å¸¦ä»»ä½•å‚æ•°ç›´æ¥è¿è¡Œè„šæœ¬ï¼Œç¨‹åºå°†è¿›å…¥äº¤äº’å¼èœå•æ¨¡å¼ã€‚

```bash
python epub_analyzer_refactored.py
```

æ‚¨ä¼šçœ‹åˆ°ä»¥ä¸‹ä¸»èœå•ï¼š

```
==================================================
  EPUBå°è¯´é‡‘å¥åˆ†æå™¨ - äº¤äº’æ¨¡å¼
==================================================
1. å¼€å§‹åˆ†æ
2. è®¾ç½®
3. å¸®åŠ©
4. é€€å‡º
--------------------------------------------------
```

1.  **é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·é€‰æ‹© `2. è®¾ç½®`**ï¼š
    *   ç¨‹åºä¼šå±•ç¤ºä¸€ä¸ªåŒ…å«æ‰€æœ‰é…ç½®é¡¹çš„åˆ—è¡¨ã€‚
    *   æ ¹æ®æç¤ºï¼Œé€ä¸€è¾“å…¥æ‚¨çš„ **APIå¯†é’¥ (`api_key`)** å’Œ **EPUBæ–‡ä»¶è·¯å¾„ (`epub_path`)**ï¼Œè¿™æ˜¯è¿è¡Œåˆ†ææ‰€å¿…éœ€çš„ã€‚
    *   æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹å…¶ä»–é…ç½®ï¼Œå¦‚APIæ¨¡å‹ã€è¾“å‡ºæ–‡ä»¶è·¯å¾„ç­‰ã€‚
    *   **ç¼–è¾‘æç¤ºè¯**ï¼šæ‚¨å¯ä»¥é€‰æ‹©â€œç¼–è¾‘æç¤ºè¯â€é€‰é¡¹ï¼Œç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨è®°äº‹æœ¬ï¼ˆæˆ–æ‚¨ç³»ç»Ÿçš„é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰è®©æ‚¨æ–¹ä¾¿åœ°ä¿®æ”¹å‘é€ç»™AIçš„æŒ‡ä»¤ã€‚ä¿®æ”¹ã€ä¿å­˜å¹¶å…³é—­è®°äº‹æœ¬åï¼Œæ–°çš„æç¤ºè¯å°±ä¼šè¢«é‡‡çº³ã€‚
    *   è®¾ç½®å®Œæˆåï¼Œå¯ä»¥é€‰æ‹© **æµ‹è¯•APIè¿æ¥** æ¥ç¡®ä¿æ‚¨çš„é…ç½®æ— è¯¯ã€‚
    *   æœ€åï¼Œé€‰æ‹© **ä¿å­˜å¹¶è¿”å›ä¸»èœå•**ã€‚æ‚¨çš„é…ç½®å°†è¢«å†™å…¥ `config.json` æ–‡ä»¶ã€‚

2.  **é…ç½®å®Œæˆåï¼Œé€‰æ‹© `1. å¼€å§‹åˆ†æ`**ï¼š
    *   ç¨‹åºå°†ä½¿ç”¨æ‚¨åˆšæ‰ä¿å­˜çš„é…ç½®æ¥å¯åŠ¨åˆ†ææµç¨‹ã€‚
    *   åˆ†æè¿›åº¦ä¼šå®æ—¶æ˜¾ç¤ºåœ¨æ§åˆ¶å°ã€‚æ‚¨å¯ä»¥éšæ—¶æŒ‰ `Ctrl+C` ä¸­æ–­ï¼Œä¸‹æ¬¡è¿è¡Œæ—¶ç¨‹åºä¼šè‡ªåŠ¨ç»­ä¼ ã€‚
    *   å¦‚æœctrl+cæŒ‰åæ²¡ååº”ï¼Œè¯·ç­‰å¾…ä¸€ä¼šï¼Œæ­£åœ¨ä¸­æ–­apiè¯·æ±‚

3.  **éœ€è¦å¸®åŠ©ï¼Ÿé€‰æ‹© `3. å¸®åŠ©`**ï¼š
    *   è¿™é‡Œæä¾›äº†ç¨‹åºçš„ç®€è¦è¯´æ˜ã€‚

### æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œæ¨¡å¼ (é€‚åˆè‡ªåŠ¨åŒ–å’Œé«˜çº§ç”¨æˆ·)

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤åé™„åŠ å‚æ•°æ¥ç›´æ¥è¿è¡Œåˆ†æã€‚å‘½ä»¤è¡Œå‚æ•°ä¼š**è¦†ç›–** `config.json` ä¸­çš„åŒåè®¾ç½®ã€‚

#### åŸºæœ¬ç”¨æ³•

æœ€åŸºç¡€çš„ç”¨æ³•æ˜¯æä¾›EPUBæ–‡ä»¶è·¯å¾„å’ŒAPIå¯†é’¥ï¼š

```bash
python epub_analyzer_refactored.py "ä½ çš„å°è¯´.epub" --api-key "ä½ çš„APIå¯†é’¥"
```

#### å¸¸ç”¨å‚æ•°ç¤ºä¾‹

- **ä½¿ç”¨ä¸åŒçš„æ¨¡å‹å’Œè¾“å‡ºè·¯å¾„**ï¼š
  ```bash
  python epub_analyzer_refactored.py "å°è¯´.epub" --api-key "sk-..." --model "gpt-4" --output "æ–°ç»“æœ.json"
  ```

- **ä¸ä½¿ç”¨æ–­ç‚¹ç»­ä¼ ï¼Œå¼ºåˆ¶ä»å¤´å¼€å§‹åˆ†æ**ï¼š
  ```bash
  python epub_analyzer_refactored.py "å°è¯´.epub" --api-key "sk-..." --no-resume
  ```

- **ä»…é‡è¯•æ‰€æœ‰ä¹‹å‰å¤±è´¥çš„ç« èŠ‚**ï¼š
  ```bash
  python epub_analyzer_refactored.py "å°è¯´.epub" --api-key "sk-..." --retry-failed
  ```

- **é‡æ–°åˆ†æç¬¬10ã€20-25ç« **ï¼š
  ```bash
  python epub_analyzer_refactored.py "å°è¯´.epub" --api-key "sk-..." --re-analyze 10 20-25
  ```

- **æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‚æ•°**ï¼š
  ```bash
  python epub_analyzer_refactored.py --help
  ```

## ğŸ› ï¸ é…å¥—å·¥å…·

### é‡‘å¥å®¡æ ¸å·¥å…· (`golden_sentence_editor/`)

è¿™æ˜¯ä¸€ä¸ªå›¾å½¢ç•Œé¢çš„é‡‘å¥å®¡æ ¸å·¥å…·ï¼Œç”¨äºå¯¹AIåˆ†æçš„ç»“æœè¿›è¡Œäººå·¥å®¡æ ¸å’Œè°ƒæ•´ï¼Œæ˜¯ç¡®ä¿æœ€ç»ˆè¾“å‡ºè´¨é‡çš„å…³é”®ç¯èŠ‚ã€‚

![é‡‘å¥ç¼–è¾‘å™¨æˆªå›¾](screen/edit.png)

#### åŠŸèƒ½ç®€ä»‹

- **åŠ è½½ä¸ä¿å­˜**ï¼šå¯ä»¥æ‰“å¼€åˆ†æå™¨ç”Ÿæˆçš„`..._part_N.json`ç»“æœæ–‡ä»¶ï¼Œå¹¶èƒ½éšæ—¶ä¿å­˜å®¡æ ¸è¿›åº¦ã€‚
- **é€æ¡å®¡æ ¸**ï¼šæ¸…æ™°åœ°å±•ç¤ºæ¯ä¸€æ¡é‡‘å¥çš„è¯´è¯äººã€å†…å®¹å’Œæ¥æºç« èŠ‚ã€‚
- **ä¾¿æ·æ“ä½œ**ï¼šé€šè¿‡â€œé€šè¿‡â€å’Œâ€œä¸é€šè¿‡â€æŒ‰é’®å¿«é€Ÿæ ‡è®°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ–‡æœ¬æ¡†ä¸­ä¿®æ”¹å†…å®¹ã€‚
- **ä¸Šä¸‹æ–‡æŸ¥è¯¢**ï¼šä¸€é”®æŸ¥çœ‹é‡‘å¥æ‰€åœ¨çš„åŸå§‹ç« èŠ‚ä¸Šä¸‹æ–‡ã€‚
- **å¥å­åˆå¹¶**ï¼šå¯¹äºè¢«AIé”™è¯¯åˆ‡åˆ†çš„è¿ç»­å¥å­ï¼Œå¯ä»¥ä½¿ç”¨åˆå¹¶åŠŸèƒ½å°†å…¶æ¢å¤ä¸ºä¸€æ¡å®Œæ•´çš„é‡‘å¥ã€‚
- **ä¸»é¢˜åˆ‡æ¢**ï¼šæ”¯æŒæµ…è‰²å’Œæ·±è‰²ä¸¤ç§ä¸»é¢˜æ¨¡å¼ã€‚

#### ä½¿ç”¨æ–¹æ³•

1.  è¿è¡Œ `python golden_sentence_editor/golden_sentence_editor.py` å¯åŠ¨ç¨‹åºã€‚
2.  é€šè¿‡èœå• **æ–‡ä»¶** > **æ‰“å¼€é‡‘å¥JSONæ–‡ä»¶...** æ¥åŠ è½½ä¸€ä¸ªæˆ–å¤šä¸ªç”±ä¸»ç¨‹åºç”Ÿæˆçš„ `..._part_N.json` æ–‡ä»¶ã€‚
3.  ä½¿ç”¨ **ä¸Šä¸€æ¡** / **ä¸‹ä¸€æ¡** æŒ‰é’®è¿›è¡Œå¯¼èˆªã€‚
4.  å¯¹æ¯ä¸€æ¡é‡‘å¥è¿›è¡Œå®¡æ ¸ï¼š
    *   å¦‚æœæ»¡æ„ï¼Œç‚¹å‡» **é€šè¿‡**ã€‚
    *   å¦‚æœä¸æ»¡æ„ï¼Œç‚¹å‡» **ä¸é€šè¿‡**ã€‚
    *   å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œç›´æ¥åœ¨æ–‡æœ¬æ¡†é‡Œç¼–è¾‘ï¼Œç„¶åç‚¹å‡» **é€šè¿‡**ã€‚
5.  å¯ä»¥éšæ—¶é€šè¿‡èœå• **æ–‡ä»¶** > **ä¿å­˜è¿›åº¦** æ¥ä¿å­˜æ‚¨çš„å·¥ä½œã€‚
6.  å…¨éƒ¨å®¡æ ¸å®Œæˆåï¼Œé€šè¿‡èœå• **æ–‡ä»¶** > **å¦å­˜ä¸ºæœ€ç»ˆç»“æœ...** æ¥ç”Ÿæˆä¸€ä»½åªåŒ…å«å·²é€šè¿‡é‡‘å¥çš„ã€å¹²å‡€çš„JSONæ–‡ä»¶ã€‚

### `fix_json_chapter.py`

ä¸€ä¸ªç”¨äºä¿®å¤ç‰¹å®šJSONæ–‡ä»¶ï¼ˆé»˜è®¤ä¸º`test.json`ï¼‰ç« èŠ‚æ ‡é¢˜å’Œæ•°æ®æ ¼å¼çš„å‘½ä»¤è¡Œè„šæœ¬ã€‚

## âš™ï¸ é…ç½®æ–‡ä»¶ (`config.json`)

è¿™æ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨æ‚¨çš„å¸¸ç”¨è®¾ç½®ã€‚å½“æ‚¨åœ¨äº¤äº’æ¨¡å¼ä¸‹ä¿å­˜è®¾ç½®æ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºæˆ–æ›´æ–°æ­¤æ–‡ä»¶ã€‚

ä¸€ä¸ªå…¸å‹çš„ `config.json` æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
    "api_key": "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxx",
    "base_url": "https://xxxxxxx/v1",
    "model": "gemini-2.5-pro",
    "epub_path": "C:/Users/YourName/Documents/MyNovel.epub",
    "output": "analysis_results_refactored.json",
    "report": "analysis_report_refactored.md",
    "max_tokens": 5000,
    "timeout": 180.0,
    "delay": 2.0
}

```
## htmlä½¿ç”¨æ–¹æ³•ï¼š
* å…ˆä¿®æ”¹htmlé‡Œé¢çš„test.json
* ç„¶åè¿è¡Œpython -m http.server 7000

## è‡´è°¢
æ„Ÿè°¢FunnyCupsï¼ŒTBï¼Œbanlanï¼ŒLazy_Craftç­‰å¤§ä½¬æä¾›çš„æ”¯æŒï¼ˆæ’åä¸åˆ†å…ˆåï¼‰ï¼Œè¿™ä¸ªé¡¹ç›®æ‰èƒ½å¤Ÿè¯ç”Ÿ